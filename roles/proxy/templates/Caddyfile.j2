{
  log {
    output file /var/log/caddy/caddy.log {
      roll_size 10mb
      roll_keep 20
      roll_keep_for 720h
    }
    format console
  }
{% if proxy_cloudflare_api_token is not none %}
  acme_dns cloudflare {{ proxy_cloudflare_api_token }}
{% endif %}
}

{% if proxy_cloudflare_api_token is not none %}
    acme_dns cloudflare {{ proxy_cloudflare_api_token }}
{% endif %}

{% for service in proxy_services %}
{% if service.subdomain is none %}
{{ domain }} {
{% else %}
{{ service.subdomain }}.{{ domain }} {
{% endif %}
  reverse_proxy {{ service.target }}
}
{% endfor %}
